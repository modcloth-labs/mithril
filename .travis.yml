---
language: go
env:
  global:
  - PATH=$HOME/bin:$PATH
  - ARTIFACTS_AWS_REGION=us-east-1
  - ARTIFACTS_S3_BUCKET=travis-artifacts-modcloth
  - GOPATH_DEST=$HOME/gopath/src/github.com/modcloth-labs
  - MITHRIL_PG_URI='postgres://postgres@localhost?sslmode=disable'
  - MITHRIL_PG_DB_NAME='postgres'
  - MITHRIL_PG_USER='postgres'
  - secure: ! 'XQ6DaZRsG2jrFYnCZKYjPFdMyAn124CKRm0QLWcdmdLZjuYUMxCqXsme+Dps

      bD/VLujRdFH2vQ6E1vLZFsHThPbFGthsk7TpqnlmWK2XMwfxu+u5ScmKVHjj

      OVMgWJ1E+rp6JRFXPwElIUafF8DdhCP2psjoSW+bllpk+1XT4u4='
  - secure: ! 'jvtPq/Rly6kGnt8fDEQjmFKO/wO1GlnWFkUz3bbhpjBC+Bb7wbYVkCgZ/MU6

      KZO53L6qygDOigA+dhit0JmLMJHOuvhU68hmotvCcAbPMK/TaWigvfGaHpYo

      a2Zd0SMWwHYpkKUR+z70myetzdGbspPnD4ipsAQzFaT8/ZzTqI4='
  - secure: ! 'rvw3oFZcX12P3CdLvP9auZH5S01sdZ89vm/oacTI4Gm65Q8Rf6g94FpLfK+Y

      d+C6XSPIL89YEC0JhjqyLNlT2B2zjSUKLRO8xMoy9LVDrf2eEilbDowBPMts

      GfyqS0sSAc2PCau42frH4lrvsl7mSD3QD6OV3qiPvzfkJUDAQXo='
  matrix:
  - MITHRIL_PG_ENABLED='true' GO_TAG_ARGS='-tags full'
  - MITHRIL_PG_ENABLED='false' GO_TAG_ARGS=''
services:
- rabbitmq
before_install:
- mkdir -p $HOME/bin
- pushd $HOME/bin
- sudo rabbitmq-plugins enable rabbitmq_management
- curl http://guest:guest@localhost:15672/cli/rabbitmqadmin > $HOME/bin/rabbitmqadmin
- chmod +x $HOME/bin/rabbitmqadmin
- curl -s -O https://raw.github.com/modcloth-labs/travis-buddy/v0.1.0/tb
- chmod +x tb
- popd
- tb setup-aws
- if tb nopr ; then tb install-travis-artifacts ; fi
install: cd $TRAVIS_BUILD_DIR && make build
script: cd $TRAVIS_BUILD_DIR && make golden
after_success:
- if tb nopr ; then tb upload-go-artifacts --encrypt ; tb upload-artifact artifacts/binaries/$(go
  env GOOS)/$(go env GOARCH)/mithril/$TRAVIS_COMMIT/ --encrypt ; fi
notifications:
  email:
    recipients:
    - flintknappers+mithril@modcloth.com
